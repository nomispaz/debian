architecture: amd64

actions:
  # Bootstrap minimal Debian Sid
  - action: debootstrap
    suite: sid
    components:
      - main
      - contrib
      - non-free-firmware
    mirror: https://deb.debian.org/debian
    variant: minbase

  # Install required packages
  - action: apt
    packages: [ linux-image-amd64, dracut, sudo, systemd-sysv, ostree, gnupg ]

  # Set hostname
  - action: run
    chroot: true
    command: echo debian > /etc/hostname

  # Move /etc to /usr/etc for OSTree
  - action: run
    chroot: true
    command: mv /etc /usr/etc

  # Cleanup ephemeral directories for OSTree
  - action: run
    chroot: true
    command: |
      rm -rf /dev /proc /sys /run /tmp

  # Optional: pack root filesystem for debugging
  - action: pack
    file: /tmp/debian-ostree.img
    compression: gz

